<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>step-inside ë²”ìš© í•™ìŠµì§€</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    
    h1, h2 {
      color: #2b3e50;
    }
    
    section {
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    input[type="text"], input[type="url"], textarea, select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 8px;
      margin-bottom: 16px;
      resize: vertical;
      box-sizing: border-box;
      font-family: inherit;
    }
    
    select {
      cursor: pointer;
    }
    
    /* ì œëª© ë° ì •ë³´ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
    input[style*="border: none"] {
      padding: 5px 0;
      font-family: inherit;
    }
    
    input[style*="border: none"]:focus {
      outline: none;
      border-bottom: 2px solid #3498db !important;
    }
    
    /* í…œí”Œë¦¿ ì„ íƒ ë²„íŠ¼ */
    .template-selector {
      background-color: #e8f4fd;
      border: 2px solid #3498db;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      text-align: center;
    }
    
    .template-selector h3 {
      margin-top: 0;
      color: #2980b9;
    }
    
    .template-btn {
      background-color: white;
      border: 2px solid #3498db;
      padding: 8px 16px;
      margin: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .template-btn:hover {
      background-color: #3498db;
      color: white;
    }
    
    .template-btn.active {
      background-color: #2980b9;
      color: white;
      border-color: #2980b9;
    }
    
    /* ì½˜í…ì¸  ì •ë³´ ì„¹ì…˜ */
    .content-info {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .content-info-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 15px;
      align-items: start;
    }
    
    /* ë™ì  ìš”ì†Œ ìŠ¤íƒ€ì¼ */
    .learning-item, .question-item, .answer-item, .reflection-item {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      gap: 10px;
    }
    
    .learning-item input, .question-item input {
      flex: 1;
    }
    
    .answer-item, .reflection-item {
      flex-direction: column;
      align-items: stretch;
    }
    
    .answer-item label, .reflection-item label {
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .question-preview {
      font-style: italic;
      color: #666;
      margin-bottom: 8px;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 4px;
      border-left: 3px solid #3498db;
      min-height: 20px;
    }
    
    .reflection-question {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .add-btn {
      background-color: #27ae60;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 10px;
      transition: background-color 0.3s;
    }
    
    .add-btn:hover {
      background-color: #229954;
    }
    
    .remove-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      min-width: 30px;
      transition: background-color 0.3s;
    }
    
    .remove-btn:hover {
      background-color: #c0392b;
    }
    
    a {
      color: #0066cc;
      text-decoration: none;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    .download-section {
      background-color: #e8f4fd;
      border: 2px solid #3498db;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .download-btn {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      margin: 8px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    
    .download-btn:hover {
      background-color: #2980b9;
    }
    
    .download-btn:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
    }
    
    .loading {
      color: #7f8c8d;
      font-style: italic;
    }
    
    /* ìˆ¨ê¹€ ì²˜ë¦¬ */
    .hidden {
      display: none !important;
    }
    
    /* ì¸ì‡„ ì‹œ ìŠ¤íƒ€ì¼ */
    @media print {
      body {
        background-color: white;
        padding: 0;
        max-width: none;
      }
      .download-section, .template-selector {
        display: none;
      }
      section {
        box-shadow: none;
        border: 1px solid #ddd;
        page-break-inside: avoid;
      }
      input, textarea, select {
        border: none !important;
        border-bottom: 1px solid #333 !important;
        background: transparent !important;
        -webkit-appearance: none;
        box-shadow: none !important;
      }
      .question-preview {
        background: #f5f5f5 !important;
        border-left: 2px solid #333 !important;
        color: #333 !important;
      }
    }
  </style>
</head>
<body>
  <div id="worksheet-content">
    <!-- í…œí”Œë¦¿ ì„ íƒ -->
    <section class="template-selector">
      <h3>ğŸ¯ ë¹ ë¥¸ í…œí”Œë¦¿ ì„ íƒ</h3>
      <button class="template-btn" onclick="applyTemplate('literature')">ğŸ“š ë¬¸í•™</button>
      <button class="template-btn" onclick="applyTemplate('movie')">ğŸ¬ ì˜í™”/ë“œë¼ë§ˆ</button>
      <button class="template-btn" onclick="applyTemplate('news')">ğŸ“° ì‹œì‚¬/ë‰´ìŠ¤</button>
      <button class="template-btn" onclick="applyTemplate('science')">ğŸ§ª ê³¼í•™/íƒêµ¬</button>
      <button class="template-btn" onclick="applyTemplate('history')">ğŸ“œ ì—­ì‚¬</button>
      <button class="template-btn active" onclick="applyTemplate('custom')">âœï¸ ì§ì ‘ ë§Œë“¤ê¸°</button>
    </section>

    <section>
      <h1><input type="text" id="worksheetTitle" value="step-inside í•™ìŠµì§€" style="font-size: 28px; font-weight: bold; text-align: center; border: none; background: transparent;" /></h1>
      <h2><input type="text" id="worksheetSubtitle" placeholder="ë¶€ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="font-size: 20px; text-align: center; border: none; background: transparent;" /></h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
        <p><strong>ê³¼ëª©:</strong> <input type="text" id="subject" placeholder="ê³¼ëª©ëª…" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
        <p><strong>ë‚ ì§œ:</strong> <input type="text" id="date" placeholder="YYYY-MM-DD" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px;">
        <p><strong>í•™êµ:</strong> <input type="text" id="school" placeholder="â—‹â—‹í•™êµ" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
        <p><strong>í•™ë…„ë°˜:</strong> <input type="text" id="classInfo" placeholder="â—‹í•™ë…„ â—‹ë°˜" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
        <p><strong>ì´ë¦„:</strong> <input type="text" id="studentName" placeholder="ì´ë¦„" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
      </div>
    </section>

    <!-- ì½˜í…ì¸  ì •ë³´ -->
    <section>
      <h2>ì½˜í…ì¸  ì •ë³´</h2>
      <div class="content-info">
        <div class="content-info-grid">
          <div>
            <label for="contentType">ì½˜í…ì¸  ìœ í˜•:</label>
            <select id="contentType" onchange="updateTargetOptions()">
              <option value="video">ğŸ“¹ ì˜ìƒ</option>
              <option value="book">ğŸ“š ì±…</option>
              <option value="movie">ğŸ¬ ì˜í™”/ë“œë¼ë§ˆ</option>
              <option value="article">ğŸ“° ê¸°ì‚¬/ë‰´ìŠ¤</option>
              <option value="podcast">ğŸ§ íŒŸìºìŠ¤íŠ¸</option>
              <option value="experiment">ğŸ§ª ì‹¤í—˜/ê´€ì°°</option>
              <option value="other">ğŸ”— ê¸°íƒ€</option>
            </select>
          </div>
          <div>
            <label for="contentTitle">ì œëª©:</label>
            <input type="text" id="contentTitle" placeholder="ì˜ˆ: ì–´ë¦°ì™•ì, ê¸°ìƒì¶©, TED ê°•ì—° ì œëª© ë“±" />
          </div>
        </div>
        <label for="contentLink">ë§í¬ (ì„ íƒì‚¬í•­):</label>
        <input type="url" id="contentLink" placeholder="https://..." />
        
        <label for="targetType">ëŒ€í™” ëŒ€ìƒ:</label>
        <select id="targetType" onchange="checkCustomTarget()">
          <option value="character">ë“±ì¥ì¸ë¬¼</option>
          <option value="speaker">í™”ì/ì—°ì‚¬</option>
          <option value="author">ì‘ê°€/ì €ì</option>
          <option value="protagonist">ì£¼ì¸ê³µ</option>
          <option value="interviewee">ì¸í„°ë·°ì´</option>
          <option value="scientist">ê³¼í•™ì/ì—°êµ¬ì</option>
          <option value="custom">ì§ì ‘ ì…ë ¥</option>
        </select>
        <input type="text" id="customTarget" class="hidden" placeholder="ëŒ€í™” ëŒ€ìƒì„ ì…ë ¥í•˜ì„¸ìš”" style="margin-top: 10px;" />
      </div>
    </section>

    <section>
      <h2><span id="step1Title">1ë‹¨ê³„. ì½˜í…ì¸  ê°ìƒ: ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš© ì •ë¦¬í•˜ê¸°</span></h2>
      <p id="step1Description">
        ì½˜í…ì¸ ë¥¼ ê°ìƒí•˜ê³ , ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš©ì´ë‚˜ ì¸ìƒ ê¹Šì€ ë¶€ë¶„ì„ ì •ë¦¬í•´ë³´ì„¸ìš”.
        <span id="contentLinkDisplay"></span>
      </p>
      
      <div id="learningContent">
        <div class="learning-item">
          <input type="text" placeholder="ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš©ì´ë‚˜ ì¸ìƒ ê¹Šì€ ë¶€ë¶„ì„ ì ì–´ë³´ì„¸ìš”" />
          <button type="button" onclick="removeLearningItem(this)" class="remove-btn">âœ•</button>
        </div>
      </div>
      <button type="button" onclick="addLearningItem()" class="add-btn">+ ë‚´ìš© ì¶”ê°€í•˜ê¸°</button>
    </section>
    
    <section>
      <h2><span id="step2Title">2ë‹¨ê³„. ëŒ€í™”í•˜ê¸°: ì§ˆë¬¸ ë§Œë“¤ê¸°</span></h2>
      <p id="step2Description">ì½˜í…ì¸  ì† <span class="target-name">ëŒ€ìƒ</span>ì—ê²Œ ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
      
      <div id="questionContent">
        <div class="question-item">
          <label>ê¸°ë³¸ ì§ˆë¬¸:</label>
          <input type="text" placeholder="ì™œ ê·¸ëŸ° ì„ íƒì„ í•˜ì…¨ë‚˜ìš”?" />
        </div>
        <div class="question-item">
          <label>ì¶”ê°€ ì§ˆë¬¸ 1:</label>
          <input type="text" placeholder="ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ì ì–´ë³´ì„¸ìš”" />
          <button type="button" onclick="removeQuestionItem(this)" class="remove-btn">âœ•</button>
        </div>
      </div>
      <button type="button" onclick="addQuestionItem()" class="add-btn">+ ì§ˆë¬¸ ì¶”ê°€í•˜ê¸°</button>
    </section>
    
    <section>
      <h2><span id="step3Title">3ë‹¨ê³„. ê³µê°í•˜ê¸°: ì…ì¥ ë°”ê¿” ìƒê°í•˜ê¸°</span></h2>
      <p id="step3Description">2ë‹¨ê³„ì—ì„œ ë§Œë“  ì§ˆë¬¸ë“¤ì— <span class="target-name">ëŒ€ìƒ</span>ì˜ ì…ì¥ì´ ë˜ì–´ ë‹µí•´ë³´ì„¸ìš”.</p>
      
      <div id="answerContent">
        <div class="answer-item">
          <label id="answer-label-0">ê¸°ë³¸ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µ:</label>
          <div class="question-preview" id="question-preview-0">ì§ˆë¬¸: ì™œ ê·¸ëŸ° ì„ íƒì„ í•˜ì…¨ë‚˜ìš”?</div>
          <textarea rows="3" placeholder="ê·¸ë“¤ì˜ ì…ì¥ì—ì„œ ë‹µë³€í•´ë³´ì„¸ìš”"></textarea>
        </div>
        <div class="answer-item">
          <label id="answer-label-1">ì¶”ê°€ ì§ˆë¬¸ 1ì— ëŒ€í•œ ë‹µ:</label>
          <div class="question-preview" id="question-preview-1">ì§ˆë¬¸: ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ì ì–´ë³´ì„¸ìš”</div>
          <textarea rows="3" placeholder="ê·¸ë“¤ì˜ ì…ì¥ì—ì„œ ë‹µë³€í•´ë³´ì„¸ìš”"></textarea>
        </div>
      </div>
    </section>
    
    <section>
      <h2><span id="step4Title">4ë‹¨ê³„. ë‚˜ì™€ ì—°ê²°í•˜ì—¬ ì„±ì°°í•˜ê¸°</span></h2>
      <div id="reflectionContent">
        <div class="reflection-item">
          <div class="reflection-question">Q. ì´ ì½˜í…ì¸ ë¥¼ ë³´ë©° ì–´ë–¤ ëŠë‚Œì´ë‚˜ ê°ì •ì´ ë“¤ì—ˆë‚˜ìš”?</div>
          <textarea rows="3" placeholder="ì¸ìƒ ê¹Šì—ˆë˜ ì¥ë©´ì´ë‚˜ ê·¸ë•Œ ëŠê¼ˆë˜ ê°ì •ì„ ì†”ì§í•˜ê²Œ ì ì–´ë³´ì„¸ìš”"></textarea>
        </div>
        
        <div class="reflection-item">
          <div class="reflection-question">Q. ìƒˆë¡­ê²Œ ê¹¨ë‹¬ì€ ì ì´ë‚˜ ë°°ìš´ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?</div>
          <textarea rows="3" placeholder="ì´ì „ì— ëª°ëë˜ ê²ƒ, ë‹¤ì‹œ ìƒê°í•˜ê²Œ ëœ ê²ƒì„ ì ì–´ë³´ì„¸ìš”"></textarea>
        </div>
        
        <div class="reflection-item">
          <div class="reflection-question">Q. ë‚˜ì˜ ì‚¶ì— ì–´ë–»ê²Œ ì ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”?</div>
          <textarea rows="3" placeholder="ì•ìœ¼ë¡œ ì‹¤ì²œí•˜ê³  ì‹¶ì€ êµ¬ì²´ì ì¸ í–‰ë™ì´ë‚˜ ë‹¤ì§ì„ ì ì–´ë³´ì„¸ìš”"></textarea>
        </div>
      </div>
    </section>
    
    <section class="download-section">
      <h3>ğŸ“¥ í•™ìŠµì§€ ì €ì¥í•˜ê¸°</h3>
      <p>ì‘ì„±ì„ ì™„ë£Œí•˜ì…¨ë‹¤ë©´ ì´ë¯¸ì§€ë‚˜ PDFë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <button class="download-btn" onclick="downloadAsImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
      <button class="download-btn" onclick="downloadAsPDF()">ğŸ“„ PDFë¡œ ì €ì¥</button>
      <div id="loading-message" class="loading" style="display: none;">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
    </section>
  </div>

  <script>
    // í…œí”Œë¦¿ ë°ì´í„°
    const templates = {
      literature: {
        title: "ë¬¸í•™ì‘í’ˆ step-inside",
        contentType: "book",
        targetType: "character",
        step1: "ì‘í’ˆ ì½ê¸°: ì¸ìƒ ê¹Šì€ êµ¬ì ˆì´ë‚˜ ì¥ë©´ ì •ë¦¬í•˜ê¸°",
        step2: "ë“±ì¥ì¸ë¬¼ê³¼ ëŒ€í™”í•˜ê¸°",
        step3: "ë“±ì¥ì¸ë¬¼ì˜ ì…ì¥ì—ì„œ ë‹µí•˜ê¸°",
        reflections: [
          "Q. ì´ ì‘í’ˆì„ ì½ìœ¼ë©° ì–´ë–¤ ê°ì •ì„ ëŠê¼ˆë‚˜ìš”?",
          "Q. ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì¥ë©´ì€ ë¬´ì—‡ì´ê³ , ì™œ ê·¸ëŸ°ê°€ìš”?",
          "Q. ë‚˜ë¼ë©´ ì£¼ì¸ê³µê³¼ ê°™ì€ ìƒí™©ì—ì„œ ì–´ë–»ê²Œ í–ˆì„ê¹Œìš”?"
        ]
      },
      movie: {
        title: "ì˜í™”/ë“œë¼ë§ˆ step-inside",
        contentType: "movie",
        targetType: "character",
        step1: "ì˜ìƒ ê°ìƒ: ì£¼ìš” ì¥ë©´ê³¼ ëŒ€ì‚¬ ì •ë¦¬í•˜ê¸°",
        step2: "ë“±ì¥ì¸ë¬¼ ë˜ëŠ” ê°ë…ì—ê²Œ ì§ˆë¬¸í•˜ê¸°",
        step3: "ê·¸ë“¤ì˜ ê´€ì ì—ì„œ ë‹µí•˜ê¸°",
        reflections: [
          "Q. ì–´ë–¤ ì¥ë©´ì´ ê°€ì¥ ì¸ìƒ ê¹Šì—ˆë‚˜ìš”?",
          "Q. ì‘í’ˆì´ ì „í•˜ê³ ì í•˜ëŠ” ë©”ì‹œì§€ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?",
          "Q. ì´ ì‘í’ˆì´ ë‚˜ì—ê²Œ ì¤€ ì˜í–¥ì€ ë¬´ì—‡ì¸ê°€ìš”?"
        ]
      },
      news: {
        title: "ì‹œì‚¬ step-inside",
        contentType: "article",
        targetType: "interviewee",
        step1: "ê¸°ì‚¬ ì½ê¸°: í•µì‹¬ ì‚¬ì‹¤ê³¼ ìŸì  ì •ë¦¬í•˜ê¸°",
        step2: "ê´€ë ¨ ì¸ë¬¼ë“¤ì—ê²Œ ì§ˆë¬¸í•˜ê¸°",
        step3: "ë‹¤ì–‘í•œ ì…ì¥ì—ì„œ ë‹µí•˜ê¸°",
        reflections: [
          "Q. ì´ ì´ìŠˆì— ëŒ€í•œ ë‚˜ì˜ ì²« ëŠë‚Œì€ ì–´ë–¤ê°€ìš”?",
          "Q. ì„œë¡œ ë‹¤ë¥¸ ì…ì¥ë“¤ì„ ì´í•´í•˜ê²Œ ë˜ì—ˆë‚˜ìš”?",
          "Q. ì´ ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” ì¼ì€?"
        ]
      },
      science: {
        title: "ê³¼í•™íƒêµ¬ step-inside",
        contentType: "experiment",
        targetType: "scientist",
        step1: "ì‹¤í—˜/ê´€ì°°: ë°œê²¬í•œ í˜„ìƒê³¼ ë°ì´í„° ì •ë¦¬í•˜ê¸°",
        step2: "ê³¼í•™ìì˜ ê´€ì ì—ì„œ ì§ˆë¬¸ ë§Œë“¤ê¸°",
        step3: "ê°€ì„¤ì„ ì„¸ìš°ê³  ì„¤ëª…í•˜ê¸°",
        reflections: [
          "Q. ê°€ì¥ ë†€ë¼ì› ë˜ ë°œê²¬ì€ ë¬´ì—‡ì¸ê°€ìš”?",
          "Q. ì´ í˜„ìƒì´ ì¼ìƒìƒí™œê³¼ ì–´ë–¤ ì—°ê´€ì´ ìˆì„ê¹Œìš”?",
          "Q. ë” ì•Œì•„ë³´ê³  ì‹¶ì€ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?"
        ]
      },
      history: {
        title: "ì—­ì‚¬ step-inside",
        contentType: "video",
        targetType: "character",
        step1: "ì—­ì‚¬ ì½˜í…ì¸  ê°ìƒ: ì‹œëŒ€ì  ë°°ê²½ê³¼ ì‚¬ê±´ ì •ë¦¬í•˜ê¸°",
        step2: "ì—­ì‚¬ì  ì¸ë¬¼ì—ê²Œ ì§ˆë¬¸í•˜ê¸°",
        step3: "ê·¸ ì‹œëŒ€ì˜ ê´€ì ì—ì„œ ë‹µí•˜ê¸°",
        reflections: [
          "Q. ê·¸ë“¤ì˜ ì„ íƒì„ ë³´ë©° ì–´ë–¤ ëŠë‚Œì´ ë“¤ì—ˆë‚˜ìš”?",
          "Q. ì—­ì‚¬ì—ì„œ ë°°ìš´ êµí›ˆì€ ë¬´ì—‡ì¸ê°€ìš”?",
          "Q. í˜„ì¬ì˜ ë‚˜ëŠ” ì–´ë–¤ ê°€ì¹˜ê´€ì„ ê°–ê³  ì‚´ì•„ê°€ê³  ìˆë‚˜ìš”?"
        ]
      },
      custom: {
        title: "step-inside í•™ìŠµì§€",
        contentType: "other",
        targetType: "custom",
        step1: "ì½˜í…ì¸  ê°ìƒ: ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš© ì •ë¦¬í•˜ê¸°",
        step2: "ëŒ€í™”í•˜ê¸°: ì§ˆë¬¸ ë§Œë“¤ê¸°",
        step3: "ê³µê°í•˜ê¸°: ì…ì¥ ë°”ê¿” ìƒê°í•˜ê¸°",
        reflections: [
          "Q. ì´ ì½˜í…ì¸ ë¥¼ ë³´ë©° ì–´ë–¤ ëŠë‚Œì´ë‚˜ ê°ì •ì´ ë“¤ì—ˆë‚˜ìš”?",
          "Q. ìƒˆë¡­ê²Œ ê¹¨ë‹¬ì€ ì ì´ë‚˜ ë°°ìš´ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?",
          "Q. ë‚˜ì˜ ì‚¶ì— ì–´ë–»ê²Œ ì ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”?"
        ]
      }
    };

    // í…œí”Œë¦¿ ì ìš©
    function applyTemplate(templateName) {
      const template = templates[templateName];
      
      // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
      document.querySelectorAll('.template-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // í…œí”Œë¦¿ ë°ì´í„° ì ìš©
      document.getElementById('worksheetTitle').value = template.title;
      document.getElementById('contentType').value = template.contentType;
      document.getElementById('targetType').value = template.targetType;
      
      // ë‹¨ê³„ë³„ ì œëª© ì—…ë°ì´íŠ¸
      document.getElementById('step1Title').textContent = `1ë‹¨ê³„. ${template.step1}`;
      document.getElementById('step2Title').textContent = `2ë‹¨ê³„. ${template.step2}`;
      document.getElementById('step3Title').textContent = `3ë‹¨ê³„. ${template.step3}`;
      
      // ì„±ì°° ì§ˆë¬¸ ì—…ë°ì´íŠ¸
      updateReflectionQuestions(template.reflections);
      
      // ëŒ€ìƒ ì—…ë°ì´íŠ¸
      updateTargetOptions();
      checkCustomTarget();
      
      // ìë™ ì €ì¥
      autoSave();
    }

    // ì„±ì°° ì§ˆë¬¸ ì—…ë°ì´íŠ¸
    function updateReflectionQuestions(questions) {
      const container = document.getElementById('reflectionContent');
      container.innerHTML = '';
      
      questions.forEach((question, index) => {
        const item = document.createElement('div');
        item.className = 'reflection-item';
        item.innerHTML = `
          <div class="reflection-question">${question}</div>
          <textarea rows="3" placeholder="ë‹µë³€ì„ ì ì–´ë³´ì„¸ìš”"></textarea>
        `;
        container.appendChild(item);
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        item.querySelector('textarea').addEventListener('input', autoSave);
      });
    }

    // ì½˜í…ì¸  ìœ í˜•ì— ë”°ë¥¸ ëŒ€ìƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
    function updateTargetOptions() {
      const contentType = document.getElementById('contentType').value;
      const targetSelect = document.getElementById('targetType');
      
      // ê¸°ë³¸ ì˜µì…˜ ìœ ì§€í•˜ê³  ì½˜í…ì¸ ë³„ ì¶”ê°€ ì˜µì…˜ ì„¤ì •
      const options = {
        video: ['speaker', 'interviewee', 'character'],
        book: ['author', 'character', 'protagonist'],
        movie: ['character', 'protagonist', 'director'],
        article: ['author', 'interviewee', 'expert'],
        podcast: ['speaker', 'host', 'guest'],
        experiment: ['scientist', 'researcher', 'observer'],
        other: ['custom']
      };
      
      // ì„ íƒëœ ì½˜í…ì¸  ìœ í˜•ì— ë§ëŠ” ì²« ë²ˆì§¸ ì˜µì…˜ ì„ íƒ
      if (options[contentType] && options[contentType].length > 0) {
        targetSelect.value = options[contentType][0];
      }
      
      updateTargetName();
    }

    // ì»¤ìŠ¤í…€ ëŒ€ìƒ ì²´í¬
    function checkCustomTarget() {
      const targetType = document.getElementById('targetType').value;
      const customInput = document.getElementById('customTarget');
      
      if (targetType === 'custom') {
        customInput.classList.remove('hidden');
      } else {
        customInput.classList.add('hidden');
      }
      
      updateTargetName();
    }

    // ëŒ€ìƒ ì´ë¦„ ì—…ë°ì´íŠ¸
    function updateTargetName() {
      const targetType = document.getElementById('targetType').value;
      const customTarget = document.getElementById('customTarget').value;
      const targetNames = {
        character: 'ë“±ì¥ì¸ë¬¼',
        speaker: 'í™”ì',
        author: 'ì‘ê°€',
        protagonist: 'ì£¼ì¸ê³µ',
        interviewee: 'ì¸í„°ë·°ì´',
        scientist: 'ê³¼í•™ì',
        director: 'ê°ë…',
        host: 'ì§„í–‰ì',
        guest: 'ê²ŒìŠ¤íŠ¸',
        researcher: 'ì—°êµ¬ì',
        observer: 'ê´€ì°°ì',
        expert: 'ì „ë¬¸ê°€'
      };
      
      let targetName = targetType === 'custom' && customTarget ? customTarget : (targetNames[targetType] || 'ëŒ€ìƒ');
      
      // ëª¨ë“  target-name í´ë˜ìŠ¤ ìš”ì†Œ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.target-name').forEach(el => {
        el.textContent = targetName;
      });
      
      // ì§ˆë¬¸ placeholder ì—…ë°ì´íŠ¸
      document.querySelectorAll('#questionContent input').forEach(input => {
        if (!input.value) {
          input.placeholder = input.placeholder.replace(/.*ì—ê²Œ/, `${targetName}ì—ê²Œ`);
        }
      });
    }

    // ì½˜í…ì¸  ë§í¬ í‘œì‹œ
    function updateContentLink() {
      const link = document.getElementById('contentLink').value;
      const display = document.getElementById('contentLinkDisplay');
      
      if (link) {
        display.innerHTML = `<br><a href="${link}" target="_blank">â–¶ ì½˜í…ì¸  ë³´ê¸°</a>`;
      } else {
        display.innerHTML = '';
      }
    }

    // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ/ìˆ¨ê¹€
    function showLoading() {
      document.getElementById('loading-message').style.display = 'block';
      document.querySelectorAll('.download-btn').forEach(btn => btn.disabled = true);
    }
    
    function hideLoading() {
      document.getElementById('loading-message').style.display = 'none';
      document.querySelectorAll('.download-btn').forEach(btn => btn.disabled = false);
    }
    
    // íŒŒì¼ëª… ìƒì„±
    function generateFileName() {
      const contentType = document.getElementById('contentType').value;
      const contentTitle = document.getElementById('contentTitle').value.trim().replace(/[^ê°€-í£a-zA-Z0-9]/g, '');
      const studentName = document.getElementById('studentName').value.trim();
      const date = new Date().toISOString().split('T')[0];
      
      let fileName = 'step-inside';
      if (contentType) fileName += `_${contentType}`;
      if (contentTitle) fileName += `_${contentTitle}`;
      if (studentName) fileName += `_${studentName}`;
      fileName += `_${date}`;
      
      return fileName;
    }
    
    // ì…ë ¥ í•„ë“œë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (ìº¡ì²˜ìš©)
    function replaceInputsWithText() {
      const replacements = [];
      
      // ëª¨ë“  inputê³¼ textarea ìš”ì†Œ ì°¾ê¸°
      const inputs = document.querySelectorAll('input[type="text"], input[type="url"], textarea, select');
      
      inputs.forEach(input => {
        // ê°’ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì²˜ë¦¬
        const value = input.value.trim();
        if (value && input.tagName !== 'SELECT') {
          // ìƒˆë¡œìš´ div ìš”ì†Œ ìƒì„±
          const replacement = document.createElement('div');
          replacement.innerHTML = value;
          
          // ìŠ¤íƒ€ì¼ ë³µì‚¬
          const computedStyle = window.getComputedStyle(input);
          replacement.style.cssText = input.style.cssText;
          replacement.style.fontFamily = computedStyle.fontFamily;
          replacement.style.fontSize = computedStyle.fontSize;
          replacement.style.fontWeight = computedStyle.fontWeight;
          replacement.style.color = computedStyle.color;
          replacement.style.padding = computedStyle.padding;
          replacement.style.margin = computedStyle.margin;
          replacement.style.width = computedStyle.width;
          replacement.style.minHeight = computedStyle.height;
          replacement.style.textAlign = computedStyle.textAlign;
          replacement.style.lineHeight = computedStyle.lineHeight;
          replacement.style.borderBottom = input.style.borderBottom || '1px solid #333';
          replacement.style.background = 'transparent';
          replacement.style.whiteSpace = 'pre-wrap';
          replacement.style.wordBreak = 'break-word';
          
          // ì›ë³¸ê³¼ êµì²´í•  ìš”ì†Œ ì €ì¥
          replacements.push({
            original: input,
            replacement: replacement,
            parent: input.parentNode
          });
          
          // êµì²´ ì‹¤í–‰
          input.parentNode.replaceChild(replacement, input);
        } else if (input.tagName === 'SELECT') {
          // SELECT ìš”ì†Œì˜ ê²½ìš° ì„ íƒëœ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
          const selectedText = input.options[input.selectedIndex].text;
          const replacement = document.createElement('span');
          replacement.textContent = selectedText;
          replacement.style.cssText = input.style.cssText;
          
          replacements.push({
            original: input,
            replacement: replacement,
            parent: input.parentNode
          });
          
          input.parentNode.replaceChild(replacement, input);
        }
      });
      
      return replacements;
    }
    
    // í…ìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ì…ë ¥ í•„ë“œë¡œ ë³µì›
    function restoreInputs(replacements) {
      replacements.forEach(({ original, replacement, parent }) => {
        parent.replaceChild(original, replacement);
      });
    }
    
    // ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œ
    async function downloadAsImage() {
      showLoading();
      
      try {
        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ê³¼ í…œí”Œë¦¿ ì„ íƒê¸°ë¥¼ ì„ì‹œë¡œ ìˆ¨ê¹€
        const downloadSection = document.querySelector('.download-section');
        const templateSelector = document.querySelector('.template-selector');
        downloadSection.style.display = 'none';
        templateSelector.style.display = 'none';
        
        // ì…ë ¥ í•„ë“œë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        const replacements = replaceInputsWithText();
        
        const canvas = await html2canvas(document.getElementById('worksheet-content'), {
          scale: 2, // ê³ í™”ì§ˆ
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#f5f7fa'
        });
        
        // ì…ë ¥ í•„ë“œ ë³µì›
        restoreInputs(replacements);
        
        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ê³¼ í…œí”Œë¦¿ ì„ íƒê¸° ë‹¤ì‹œ í‘œì‹œ
        downloadSection.style.display = 'block';
        templateSelector.style.display = 'block';
        
        // ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
        const link = document.createElement('a');
        link.download = generateFileName() + '.png';
        link.href = canvas.toDataURL();
        link.click();
        
      } catch (error) {
        alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      } finally {
        hideLoading();
      }
    }
    
    // PDFë¡œ ë‹¤ìš´ë¡œë“œ
    async function downloadAsPDF() {
      showLoading();
      
      try {
        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ê³¼ í…œí”Œë¦¿ ì„ íƒê¸°ë¥¼ ì„ì‹œë¡œ ìˆ¨ê¹€
        const downloadSection = document.querySelector('.download-section');
        const templateSelector = document.querySelector('.template-selector');
        downloadSection.style.display = 'none';
        templateSelector.style.display = 'none';
        
        // ì…ë ¥ í•„ë“œë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        const replacements = replaceInputsWithText();
        
        const canvas = await html2canvas(document.getElementById('worksheet-content'), {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#f5f7fa'
        });
        
        // ì…ë ¥ í•„ë“œ ë³µì›
        restoreInputs(replacements);
        
        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ê³¼ í…œí”Œë¦¿ ì„ íƒê¸° ë‹¤ì‹œ í‘œì‹œ
        downloadSection.style.display = 'block';
        templateSelector.style.display = 'block';
        
        const imgData = canvas.toDataURL('image/png');
        
        // jsPDF ìƒì„±
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });
        
        // A4 í¬ê¸°ì— ë§ê²Œ ì´ë¯¸ì§€ í¬ê¸° ì¡°ì •
        const imgWidth = 190; // A4 ë„ˆë¹„ (ì—¬ë°± ê³ ë ¤)
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        const pageHeight = 257; // A4 ë†’ì´ì—ì„œ ìƒí•˜ ì—¬ë°± 20mmì”© ì œì™¸
        let heightLeft = imgHeight;
        let position = 20; // ìƒë‹¨ ì—¬ë°± 20mm
        
        // ì²« í˜ì´ì§€
        pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
        
        // ì¶”ê°€ í˜ì´ì§€ê°€ í•„ìš”í•œ ê²½ìš°
        while (heightLeft > 0) {
          position = heightLeft - imgHeight + 20;
          pdf.addPage();
          pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }
        
        pdf.save(generateFileName() + '.pdf');
        
      } catch (error) {
        alert('PDF ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      } finally {
        hideLoading();
      }
    }
    
    // ìë™ ì €ì¥ ê¸°ëŠ¥ (localStorage í™œìš©)
    function autoSave() {
      const data = {
        worksheetTitle: document.getElementById('worksheetTitle').value,
        worksheetSubtitle: document.getElementById('worksheetSubtitle').value,
        subject: document.getElementById('subject').value,
        date: document.getElementById('date').value,
        school: document.getElementById('school').value,
        classInfo: document.getElementById('classInfo').value,
        studentName: document.getElementById('studentName').value,
        contentType: document.getElementById('contentType').value,
        contentTitle: document.getElementById('contentTitle').value,
        contentLink: document.getElementById('contentLink').value,
        targetType: document.getElementById('targetType').value,
        customTarget: document.getElementById('customTarget').value,
        learningItems: Array.from(document.querySelectorAll('#learningContent input')).map(input => input.value),
        questionItems: Array.from(document.querySelectorAll('#questionContent input')).map(input => input.value),
        answerItems: Array.from(document.querySelectorAll('#answerContent textarea')).map(textarea => textarea.value),
        reflectionItems: Array.from(document.querySelectorAll('#reflectionContent textarea')).map(textarea => textarea.value)
      };
      localStorage.setItem('stepInsideWorksheet', JSON.stringify(data));
    }
    
    // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    function loadSavedData() {
      const saved = localStorage.getItem('stepInsideWorksheet');
      if (saved) {
        const data = JSON.parse(saved);
        
        // ê¸°ë³¸ í•„ë“œë“¤ ë³µì›
        ['worksheetTitle', 'worksheetSubtitle', 'subject', 'school', 'classInfo', 'studentName', 
         'contentType', 'contentTitle', 'contentLink', 'targetType', 'customTarget'].forEach(key => {
          const element = document.getElementById(key);
          if (element && data[key]) element.value = data[key];
        });
        
        // ë‚ ì§œëŠ” ì €ì¥ëœ ê°’ì´ ìˆê³ , í˜„ì¬ í•„ë“œê°€ ì˜¤ëŠ˜ ë‚ ì§œì¸ ê²½ìš°ì—ë§Œ ë³µì›
        const dateElement = document.getElementById('date');
        const today = new Date().toISOString().split('T')[0];
        if (data.date && dateElement.value === today) {
          dateElement.value = data.date;
        }
        
        // í•™ìŠµ ë‚´ìš© ë³µì›
        if (data.learningItems && data.learningItems.length > 1) {
          for (let i = 1; i < data.learningItems.length; i++) {
            addLearningItem();
          }
          document.querySelectorAll('#learningContent input').forEach((input, index) => {
            if (data.learningItems[index]) input.value = data.learningItems[index];
          });
        }
        
        // ì§ˆë¬¸ ë‚´ìš© ë³µì›
        if (data.questionItems && data.questionItems.length > 2) {
          for (let i = 2; i < data.questionItems.length; i++) {
            addQuestionItem();
          }
        }
        if (data.questionItems) {
          document.querySelectorAll('#questionContent input').forEach((input, index) => {
            if (data.questionItems[index]) input.value = data.questionItems[index];
          });
        }
        
        // ë‹µë³€ ë‚´ìš© ë³µì›
        if (data.answerItems) {
          document.querySelectorAll('#answerContent textarea').forEach((textarea, index) => {
            if (data.answerItems[index]) textarea.value = data.answerItems[index];
          });
        }
        
        // ì„±ì°° ë‚´ìš© ë³µì›
        if (data.reflectionItems) {
          document.querySelectorAll('#reflectionContent textarea').forEach((textarea, index) => {
            if (data.reflectionItems[index]) textarea.value = data.reflectionItems[index];
          });
        }
        
        // UI ì—…ë°ì´íŠ¸
        updateTargetOptions();
        checkCustomTarget();
        updateContentLink();
        
        // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        setTimeout(() => {
          updateQuestionPreviews();
          document.querySelectorAll('#questionContent input').forEach(input => {
            input.addEventListener('input', updateQuestionPreviews);
          });
        }, 100);
      }
    }
    
    // í•™ìŠµ ë‚´ìš© ì¶”ê°€
    function addLearningItem() {
      const container = document.getElementById('learningContent');
      const newItem = document.createElement('div');
      newItem.className = 'learning-item';
      newItem.innerHTML = `
        <input type="text" placeholder="ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš©ì´ë‚˜ ì¸ìƒ ê¹Šì€ ë¶€ë¶„ì„ ì ì–´ë³´ì„¸ìš”" />
        <button type="button" onclick="removeLearningItem(this)" class="remove-btn">âœ•</button>
      `;
      container.appendChild(newItem);
      
      // ìƒˆë¡œ ì¶”ê°€ëœ ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      newItem.querySelector('input').addEventListener('input', autoSave);
    }
    
    // í•™ìŠµ ë‚´ìš© ì œê±°
    function removeLearningItem(button) {
      const container = document.getElementById('learningContent');
      if (container.children.length > 1) {
        button.parentElement.remove();
        autoSave();
      }
    }
    
    // ì§ˆë¬¸ ì¶”ê°€
    function addQuestionItem() {
      const container = document.getElementById('questionContent');
      const questionCount = container.children.length;
      const newItem = document.createElement('div');
      newItem.className = 'question-item';
      newItem.innerHTML = `
        <label>ì¶”ê°€ ì§ˆë¬¸ ${questionCount - 1}:</label>
        <input type="text" placeholder="ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ì ì–´ë³´ì„¸ìš”" />
        <button type="button" onclick="removeQuestionItem(this)" class="remove-btn">âœ•</button>
      `;
      container.appendChild(newItem);
      
      // ë‹µë³€ ì„¹ì…˜ì—ë„ í•´ë‹¹ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ ì¹¸ ì¶”ê°€
      const answerContainer = document.getElementById('answerContent');
      const newAnswer = document.createElement('div');
      newAnswer.className = 'answer-item';
      newAnswer.innerHTML = `
        <label id="answer-label-${questionCount}">ì¶”ê°€ ì§ˆë¬¸ ${questionCount - 1}ì— ëŒ€í•œ ë‹µ:</label>
        <div class="question-preview" id="question-preview-${questionCount}">ì§ˆë¬¸: ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ì ì–´ë³´ì„¸ìš”</div>
        <textarea rows="3" placeholder="ê·¸ë“¤ì˜ ì…ì¥ì—ì„œ ë‹µë³€í•´ë³´ì„¸ìš”"></textarea>
      `;
      answerContainer.appendChild(newAnswer);
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      const newInput = newItem.querySelector('input');
      newInput.addEventListener('input', function() {
        autoSave();
        updateQuestionPreviews();
      });
      newAnswer.querySelector('textarea').addEventListener('input', autoSave);
      
      // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸° ì¦‰ì‹œ ì—…ë°ì´íŠ¸
      updateQuestionPreviews();
    }
    
    // ì§ˆë¬¸ ì œê±°
    function removeQuestionItem(button) {
      const container = document.getElementById('questionContent');
      const answerContainer = document.getElementById('answerContent');
      
      if (container.children.length > 2) { // ê¸°ë³¸ ì§ˆë¬¸ 2ê°œëŠ” ìœ ì§€
        const index = Array.from(container.children).indexOf(button.parentElement);
        button.parentElement.remove();
        
        // í•´ë‹¹í•˜ëŠ” ë‹µë³€ ì¹¸ë„ ì œê±°
        if (answerContainer.children[index]) {
          answerContainer.children[index].remove();
        }
        
        // ë¼ë²¨ ë²ˆí˜¸ ì¬ì •ë ¬
        updateQuestionLabels();
        autoSave();
      }
    }
    
    // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updateQuestionPreviews() {
      const questionInputs = document.querySelectorAll('#questionContent input');
      questionInputs.forEach((input, index) => {
        const preview = document.getElementById(`question-preview-${index}`);
        if (preview) {
          const questionText = input.value.trim() || input.placeholder;
          preview.textContent = `ì§ˆë¬¸: ${questionText}`;
        }
      });
    }
    
    // ì§ˆë¬¸ ë¼ë²¨ ë²ˆí˜¸ ì¬ì •ë ¬
    function updateQuestionLabels() {
      const questionItems = document.querySelectorAll('#questionContent .question-item');
      const answerItems = document.querySelectorAll('#answerContent .answer-item');
      
      questionItems.forEach((item, index) => {
        const label = item.querySelector('label');
        if (index === 0) {
          label.textContent = 'ê¸°ë³¸ ì§ˆë¬¸:';
        } else {
          label.textContent = `ì¶”ê°€ ì§ˆë¬¸ ${index}:`;
        }
      });
      
      answerItems.forEach((item, index) => {
        const label = item.querySelector('label');
        if (index === 0) {
          label.textContent = 'ê¸°ë³¸ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µ:';
        } else {
          label.textContent = `ì¶”ê°€ ì§ˆë¬¸ ${index}ì— ëŒ€í•œ ë‹µ:`;
        }
      });
      
      // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸°ë„ ì—…ë°ì´íŠ¸
      updateQuestionPreviews();
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    window.addEventListener('load', function() {
      // ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì„¤ì •
      const today = new Date().toISOString().split('T')[0];
      const dateField = document.getElementById('date');
      if (!dateField.value) {
        dateField.value = today;
      }
      
      loadSavedData();
      
      // ëª¨ë“  ì…ë ¥ í•„ë“œì— ìë™ ì €ì¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document.addEventListener('input', autoSave);
      
      // ì½˜í…ì¸  ë§í¬ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸
      document.getElementById('contentLink').addEventListener('input', updateContentLink);
      document.getElementById('customTarget').addEventListener('input', updateTargetName);
      
      // ì§ˆë¬¸ ì…ë ¥ í•„ë“œì— ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document.querySelectorAll('#questionContent input').forEach(input => {
        input.addEventListener('input', updateQuestionPreviews);
      });
      
      // ì´ˆê¸° ì—…ë°ì´íŠ¸
      updateTargetName();
      updateContentLink();
      updateQuestionPreviews();
    });
  </script>
</body>
</html>