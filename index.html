<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>step-inside í•™ìŠµì§€</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    
    h1, h2 {
      color: #2b3e50;
    }
    
    section {
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    input[type="text"], textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 8px;
      margin-bottom: 16px;
      resize: vertical;
      box-sizing: border-box;
    }
    
    /* ì œëª© ë° ì •ë³´ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
    input[style*="border: none"] {
      padding: 5px 0;
      font-family: inherit;
    }
    
    input[style*="border: none"]:focus {
      outline: none;
      border-bottom: 2px solid #3498db !important;
    }
    
    /* ë™ì  ìš”ì†Œ ìŠ¤íƒ€ì¼ */
    .learning-item, .question-item, .answer-item {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      gap: 10px;
    }
    
    .learning-item input, .question-item input {
      flex: 1;
    }
    
    .answer-item {
      flex-direction: column;
      align-items: stretch;
    }
    
    .answer-item label {
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .question-preview {
      font-style: italic;
      color: #666;
      margin-bottom: 8px;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 4px;
      border-left: 3px solid #3498db;
      min-height: 20px;
    }
    
    .add-btn {
      background-color: #27ae60;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 10px;
      transition: background-color 0.3s;
    }
    
    .add-btn:hover {
      background-color: #229954;
    }
    
    .remove-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      min-width: 30px;
      transition: background-color 0.3s;
    }
    
    .remove-btn:hover {
      background-color: #c0392b;
    }
    
    a {
      color: #0066cc;
      text-decoration: none;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    .download-section {
      background-color: #e8f4fd;
      border: 2px solid #3498db;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .download-btn {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      margin: 8px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    
    .download-btn:hover {
      background-color: #2980b9;
    }
    
    .download-btn:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
    }
    
    .loading {
      color: #7f8c8d;
      font-style: italic;
    }
    
    /* ì¸ì‡„ ì‹œ ìŠ¤íƒ€ì¼ */
    @media print {
      body {
        background-color: white;
        padding: 0;
        max-width: none;
      }
      .download-section {
        display: none;
      }
      section {
        box-shadow: none;
        border: 1px solid #ddd;
        page-break-inside: avoid;
      }
      input, textarea {
        border: none !important;
        border-bottom: 1px solid #333 !important;
        background: transparent !important;
        -webkit-appearance: none;
        box-shadow: none !important;
      }
      .question-preview {
        background: #f5f5f5 !important;
        border-left: 2px solid #333 !important;
        color: #333 !important;
      }
    }
  </style>
</head>
<body>
  <div id="worksheet-content">
    <section>
      <h1><input type="text" id="worksheetTitle" value="step-inside" style="font-size: 28px; font-weight: bold; text-align: center; border: none; background: transparent;" /></h1>
      <h2><input type="text" id="worksheetSubtitle" placeholder="ë¶€ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="font-size: 20px; text-align: center; border: none; background: transparent;" /></h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
        <p><strong>ê³¼ëª©:</strong> <input type="text" id="subject" placeholder="ê³¼ëª©ëª…" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
        <p><strong>ë‚ ì§œ:</strong> <input type="text" id="date" placeholder="YYYY-MM-DD" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px;">
        <p><strong>í•™êµ:</strong> <input type="text" id="school" placeholder="â—‹â—‹ì¤‘í•™êµ" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
        <p><strong>í•™ë…„ë°˜:</strong> <input type="text" id="classInfo" placeholder="â—‹í•™ë…„ â—‹ë°˜" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
        <p><strong>ì´ë¦„:</strong> <input type="text" id="studentName" placeholder="ì´ë¦„" style="border: none; border-bottom: 1px solid #ccc; background: transparent;" /></p>
      </div>
    </section>

    <section>
      <h2>1ë‹¨ê³„. ì˜ìƒ ì‹œì²­: ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš© ì •ë¦¬í•˜ê¸°</h2>
      <p>
        ì•„ë˜ ì˜ìƒì„ ì‹œì²­í•˜ê³ , ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš©ì„ ì ì–´ë³´ì„¸ìš”.<br>
        <a href="https://youtu.be/IilOyOQGLJk?si=YBh6lU9ICGCv-GJo" target="_blank">â–¶ ì•ˆì¤‘ê·¼ ì˜ì‚¬ì™€ í™ë²”ë„ ì¥êµ° ì´ì•¼ê¸° ì‹œì²­í•˜ê¸°</a>
      </p>
      
      <div id="learningContent">
        <div class="learning-item">
          <input type="text" placeholder="ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš©ì„ ì ì–´ë³´ì„¸ìš”" />
          <button type="button" onclick="removeLearningItem(this)" class="remove-btn">âœ•</button>
        </div>
      </div>
      <button type="button" onclick="addLearningItem()" class="add-btn">+ ë‚´ìš© ì¶”ê°€í•˜ê¸°</button>
    </section>
    
    <section>
      <h2>2ë‹¨ê³„. ì¸ë¬¼ì—ê²Œ ì§ˆë¬¸ ë˜ì§€ê¸°</h2>
      <p>ì˜ìƒ ì† ì¸ë¬¼ë“¤ì—ê²Œ ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
      
      <div id="questionContent">
        <div class="question-item">
          <label>ê¸°ë³¸ ì§ˆë¬¸:</label>
          <input type="text" placeholder="ì™œ ê·¸ëŸ° ì„ íƒì„ í•˜ì…¨ë‚˜ìš”?" />
        </div>
        <div class="question-item">
          <label>ì¶”ê°€ ì§ˆë¬¸ 1:</label>
          <input type="text" placeholder="ì¸ë¬¼ì—ê²Œ ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ì ì–´ë³´ì„¸ìš”" />
          <button type="button" onclick="removeQuestionItem(this)" class="remove-btn">âœ•</button>
        </div>
      </div>
      <button type="button" onclick="addQuestionItem()" class="add-btn">+ ì§ˆë¬¸ ì¶”ê°€í•˜ê¸°</button>
    </section>
    
    <section>
      <h2>3ë‹¨ê³„. ì§ˆë¬¸ì— ë‹µí•´ë³´ê¸°</h2>
      <p>2ë‹¨ê³„ì—ì„œ ë§Œë“  ì§ˆë¬¸ë“¤ì— ì¸ë¬¼ì˜ ì…ì¥ì´ ë˜ì–´ ë‹µí•´ë³´ì„¸ìš”.</p>
      
      <div id="answerContent">
        <div class="answer-item">
          <label id="answer-label-0">ê¸°ë³¸ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µ:</label>
          <div class="question-preview" id="question-preview-0" style="font-style: italic; color: #666; margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #3498db;">ì§ˆë¬¸: ì™œ ê·¸ëŸ° ì„ íƒì„ í•˜ì…¨ë‚˜ìš”?</div>
          <textarea rows="3" placeholder="ì¸ë¬¼ì˜ ì…ì¥ì—ì„œ ë‹µë³€í•´ë³´ì„¸ìš”"></textarea>
        </div>
        <div class="answer-item">
          <label id="answer-label-1">ì¶”ê°€ ì§ˆë¬¸ 1ì— ëŒ€í•œ ë‹µ:</label>
          <div class="question-preview" id="question-preview-1" style="font-style: italic; color: #666; margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #3498db;">ì§ˆë¬¸: ì¸ë¬¼ì—ê²Œ ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ì ì–´ë³´ì„¸ìš”</div>
          <textarea rows="3" placeholder="ì¸ë¬¼ì˜ ì…ì¥ì—ì„œ ë‹µë³€í•´ë³´ì„¸ìš”"></textarea>
        </div>
      </div>
    </section>
    
    <section>
      <h2>4ë‹¨ê³„. ë‚˜ì˜ ê°€ì¹˜ê´€ê³¼ ë§ˆì£¼í•˜ë©° ì„±ì°°í•˜ê¸°</h2>
      <label>Q. ì˜ìƒ ì† ì¸ë¬¼ë“¤ì˜ ì´ì•¼ê¸°ë¥¼ ë³´ë©° ì–´ë–¤ ëŠë‚Œì´ë‚˜ ê°ì •ì´ ë“¤ì—ˆë‚˜ìš”?</label>
      <textarea id="myFeelings" rows="3" placeholder="ì¸ìƒ ê¹Šì—ˆë˜ ì¥ë©´ì´ë‚˜ ê·¸ë•Œ ëŠê¼ˆë˜ ê°ì •ì„ ì†”ì§í•˜ê²Œ ì ì–´ë³´ì„¸ìš”"></textarea>
      
      <label>Q. ì´ë“¤ì˜ ì„ íƒê³¼ í–‰ë™ì—ì„œ ë³¸ë°›ê³  ì‹¶ì€ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?</label>
      <textarea id="roleModel" rows="3" placeholder="ì•ìœ¼ë¡œ ì‹¤ì²œí•˜ê³  ì‹¶ì€ êµ¬ì²´ì ì¸ í–‰ë™ì„ ì ì–´ë³´ì„¸ìš”"></textarea>
      
      <label>Q. ë‚˜ëŠ” ì–´ë–¤ ì‚¬ëŒìœ¼ë¡œ ì‚´ì•„ê°€ê³  ì‹¶ì€ê°€ìš”?</label>
      <textarea id="lifeGoal" rows="3" placeholder="ë‚˜ì˜ ë‹¤ì§ì´ë‚˜ ëª©í‘œë¥¼ ì ì–´ë³´ì„¸ìš”"></textarea>
    </section>
    
    <section class="download-section">
      <h3>ğŸ“¥ í•™ìŠµì§€ ì €ì¥í•˜ê¸°</h3>
      <p>ì‘ì„±ì„ ì™„ë£Œí•˜ì…¨ë‹¤ë©´ ì´ë¯¸ì§€ë‚˜ PDFë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <button class="download-btn" onclick="downloadAsImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
      <button class="download-btn" onclick="downloadAsPDF()">ğŸ“„ PDFë¡œ ì €ì¥</button>
      <div id="loading-message" class="loading" style="display: none;">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
    </section>
  </div>

  <script>
    // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ/ìˆ¨ê¹€
    function showLoading() {
      document.getElementById('loading-message').style.display = 'block';
      document.querySelectorAll('.download-btn').forEach(btn => btn.disabled = true);
    }
    
    function hideLoading() {
      document.getElementById('loading-message').style.display = 'none';
      document.querySelectorAll('.download-btn').forEach(btn => btn.disabled = false);
    }
    
    // íŒŒì¼ëª… ìƒì„± (í•™êµ, í•™ë…„ë°˜, ì´ë¦„ + ë‚ ì§œ)
    function generateFileName() {
      const school = document.getElementById('school').value.trim();
      const classInfo = document.getElementById('classInfo').value.trim();
      const studentName = document.getElementById('studentName').value.trim();
      const date = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
      
      let fileName = 'í•™ìŠµì§€';
      if (school) fileName += `_${school}`;
      if (classInfo) fileName += `_${classInfo}`;
      if (studentName) fileName += `_${studentName}`;
      fileName += `_${date}`;
      
      return fileName;
    }
    
    // ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œ
    async function downloadAsImage() {
      showLoading();
      
      try {
        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ì„ ì„ì‹œë¡œ ìˆ¨ê¹€
        const downloadSection = document.querySelector('.download-section');
        downloadSection.style.display = 'none';
        
        const canvas = await html2canvas(document.getElementById('worksheet-content'), {
          scale: 2, // ê³ í™”ì§ˆ
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#f5f7fa'
        });
        
        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ ë‹¤ì‹œ í‘œì‹œ
        downloadSection.style.display = 'block';
        
        // ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
        const link = document.createElement('a');
        link.download = generateFileName() + '.png';
        link.href = canvas.toDataURL();
        link.click();
        
      } catch (error) {
        alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      } finally {
        hideLoading();
      }
    }
    
    // PDFë¡œ ë‹¤ìš´ë¡œë“œ
    async function downloadAsPDF() {
      showLoading();
      
      try {
        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ì„ ì„ì‹œë¡œ ìˆ¨ê¹€
        const downloadSection = document.querySelector('.download-section');
        downloadSection.style.display = 'none';
        
        const canvas = await html2canvas(document.getElementById('worksheet-content'), {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#f5f7fa'
        });
        
        // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ ë‹¤ì‹œ í‘œì‹œ
        downloadSection.style.display = 'block';
        
        const imgData = canvas.toDataURL('image/png');
        
        // jsPDF ìƒì„±
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });
        
        // A4 í¬ê¸°ì— ë§ê²Œ ì´ë¯¸ì§€ í¬ê¸° ì¡°ì •
        const imgWidth = 190; // A4 ë„ˆë¹„ (ì—¬ë°± ê³ ë ¤)
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        const pageHeight = 257; // A4 ë†’ì´ì—ì„œ ìƒí•˜ ì—¬ë°± 20mmì”© ì œì™¸ (297-40=257)
        let heightLeft = imgHeight;
        let position = 20; // ìƒë‹¨ ì—¬ë°± 20mm
        
        // ì²« í˜ì´ì§€
        pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
        
        // ì¶”ê°€ í˜ì´ì§€ê°€ í•„ìš”í•œ ê²½ìš°
        while (heightLeft > 0) {
          position = heightLeft - imgHeight + 20; // ìƒë‹¨ ì—¬ë°± 20mm
          pdf.addPage();
          pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }
        
        pdf.save(generateFileName() + '.pdf');
        
      } catch (error) {
        alert('PDF ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      } finally {
        hideLoading();
      }
    }
    
    // ìë™ ì €ì¥ ê¸°ëŠ¥ (localStorage í™œìš©)
    function autoSave() {
      const data = {
        worksheetTitle: document.getElementById('worksheetTitle').value,
        worksheetSubtitle: document.getElementById('worksheetSubtitle').value,
        subject: document.getElementById('subject').value,
        date: document.getElementById('date').value,
        school: document.getElementById('school').value,
        classInfo: document.getElementById('classInfo').value,
        studentName: document.getElementById('studentName').value,
        learningItems: Array.from(document.querySelectorAll('#learningContent input')).map(input => input.value),
        questionItems: Array.from(document.querySelectorAll('#questionContent input')).map(input => input.value),
        answerItems: Array.from(document.querySelectorAll('#answerContent textarea')).map(textarea => textarea.value),
        myFeelings: document.getElementById('myFeelings').value,
        roleModel: document.getElementById('roleModel').value,
        lifeGoal: document.getElementById('lifeGoal').value
      };
      localStorage.setItem('moralWorksheet', JSON.stringify(data));
    }
    
    // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    function loadSavedData() {
      const saved = localStorage.getItem('moralWorksheet');
      if (saved) {
        const data = JSON.parse(saved);
        
        // ê¸°ë³¸ í•„ë“œë“¤ ë³µì› (ë‚ ì§œëŠ” ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°ì—ë§Œ)
        ['worksheetTitle', 'worksheetSubtitle', 'subject', 'school', 'classInfo', 'studentName', 'myFeelings', 'roleModel', 'lifeGoal'].forEach(key => {
          const element = document.getElementById(key);
          if (element && data[key]) element.value = data[key];
        });
        
        // ë‚ ì§œëŠ” ì €ì¥ëœ ê°’ì´ ìˆê³ , í˜„ì¬ í•„ë“œê°€ ì˜¤ëŠ˜ ë‚ ì§œì¸ ê²½ìš°ì—ë§Œ ë³µì›
        const dateElement = document.getElementById('date');
        const today = new Date().toISOString().split('T')[0];
        if (data.date && dateElement.value === today) {
          dateElement.value = data.date;
        }
        
        // í•™ìŠµ ë‚´ìš© ë³µì›
        if (data.learningItems && data.learningItems.length > 1) {
          // ê¸°ë³¸ 1ê°œ ì œì™¸í•˜ê³  ì¶”ê°€
          for (let i = 1; i < data.learningItems.length; i++) {
            addLearningItem();
          }
          // ê°’ ì„¤ì •
          document.querySelectorAll('#learningContent input').forEach((input, index) => {
            if (data.learningItems[index]) input.value = data.learningItems[index];
          });
        }
        
        // ì§ˆë¬¸ ë‚´ìš© ë³µì›
        if (data.questionItems && data.questionItems.length > 2) {
          // ê¸°ë³¸ 2ê°œ ì œì™¸í•˜ê³  ì¶”ê°€
          for (let i = 2; i < data.questionItems.length; i++) {
            addQuestionItem();
          }
        }
        if (data.questionItems) {
          document.querySelectorAll('#questionContent input').forEach((input, index) => {
            if (data.questionItems[index]) input.value = data.questionItems[index];
          });
        }
        
        // ë‹µë³€ ë‚´ìš© ë³µì›
        if (data.answerItems) {
          document.querySelectorAll('#answerContent textarea').forEach((textarea, index) => {
            if (data.answerItems[index]) textarea.value = data.answerItems[index];
          });
        }
        
        // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        setTimeout(() => {
          updateQuestionPreviews();
          // ë³µì›ëœ ì§ˆë¬¸ ì…ë ¥ í•„ë“œë“¤ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
          document.querySelectorAll('#questionContent input').forEach(input => {
            input.addEventListener('input', updateQuestionPreviews);
          });
        }, 100);
      }
    }
    
    // í•™ìŠµ ë‚´ìš© ì¶”ê°€
    function addLearningItem() {
      const container = document.getElementById('learningContent');
      const newItem = document.createElement('div');
      newItem.className = 'learning-item';
      newItem.innerHTML = `
        <input type="text" placeholder="ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ë‚´ìš©ì„ ì ì–´ë³´ì„¸ìš”" />
        <button type="button" onclick="removeLearningItem(this)" class="remove-btn">âœ•</button>
      `;
      container.appendChild(newItem);
      
      // ìƒˆë¡œ ì¶”ê°€ëœ ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      newItem.querySelector('input').addEventListener('input', autoSave);
    }
    
    // í•™ìŠµ ë‚´ìš© ì œê±°
    function removeLearningItem(button) {
      const container = document.getElementById('learningContent');
      if (container.children.length > 1) {
        button.parentElement.remove();
        autoSave();
      }
    }
    
    // ì§ˆë¬¸ ì¶”ê°€
    function addQuestionItem() {
      const container = document.getElementById('questionContent');
      const questionCount = container.children.length;
      const newItem = document.createElement('div');
      newItem.className = 'question-item';
      newItem.innerHTML = `
        <label>ì¶”ê°€ ì§ˆë¬¸ ${questionCount - 1}:</label>
        <input type="text" placeholder="ì¸ë¬¼ì—ê²Œ ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ì ì–´ë³´ì„¸ìš”" />
        <button type="button" onclick="removeQuestionItem(this)" class="remove-btn">âœ•</button>
      `;
      container.appendChild(newItem);
      
      // ë‹µë³€ ì„¹ì…˜ì—ë„ í•´ë‹¹ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ ì¹¸ ì¶”ê°€
      const answerContainer = document.getElementById('answerContent');
      const newAnswer = document.createElement('div');
      newAnswer.className = 'answer-item';
      newAnswer.innerHTML = `
        <label id="answer-label-${questionCount}">ì¶”ê°€ ì§ˆë¬¸ ${questionCount - 1}ì— ëŒ€í•œ ë‹µ:</label>
        <div class="question-preview" id="question-preview-${questionCount}" style="font-style: italic; color: #666; margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #3498db;">ì§ˆë¬¸: ì¸ë¬¼ì—ê²Œ ë¬»ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ì ì–´ë³´ì„¸ìš”</div>
        <textarea rows="3" placeholder="ì¸ë¬¼ì˜ ì…ì¥ì—ì„œ ë‹µë³€í•´ë³´ì„¸ìš”"></textarea>
      `;
      answerContainer.appendChild(newAnswer);
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      const newInput = newItem.querySelector('input');
      newInput.addEventListener('input', function() {
        autoSave();
        updateQuestionPreviews();
      });
      newAnswer.querySelector('textarea').addEventListener('input', autoSave);
      
      // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸° ì¦‰ì‹œ ì—…ë°ì´íŠ¸
      updateQuestionPreviews();
    }
    
    // ì§ˆë¬¸ ì œê±°
    function removeQuestionItem(button) {
      const container = document.getElementById('questionContent');
      const answerContainer = document.getElementById('answerContent');
      
      if (container.children.length > 2) { // ê¸°ë³¸ ì§ˆë¬¸ 2ê°œëŠ” ìœ ì§€
        const index = Array.from(container.children).indexOf(button.parentElement);
        button.parentElement.remove();
        
        // í•´ë‹¹í•˜ëŠ” ë‹µë³€ ì¹¸ë„ ì œê±°
        if (answerContainer.children[index]) {
          answerContainer.children[index].remove();
        }
        
        // ë¼ë²¨ ë²ˆí˜¸ ì¬ì •ë ¬
        updateQuestionLabels();
        autoSave();
      }
    }
    
    // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updateQuestionPreviews() {
      const questionInputs = document.querySelectorAll('#questionContent input');
      questionInputs.forEach((input, index) => {
        const preview = document.getElementById(`question-preview-${index}`);
        if (preview) {
          const questionText = input.value.trim() || input.placeholder;
          preview.textContent = `ì§ˆë¬¸: ${questionText}`;
        }
      });
    }
    
    // ì§ˆë¬¸ ë¼ë²¨ ë²ˆí˜¸ ì¬ì •ë ¬
    function updateQuestionLabels() {
      const questionItems = document.querySelectorAll('#questionContent .question-item');
      const answerItems = document.querySelectorAll('#answerContent .answer-item');
      
      questionItems.forEach((item, index) => {
        const label = item.querySelector('label');
        if (index === 0) {
          label.textContent = 'ê¸°ë³¸ ì§ˆë¬¸:';
        } else {
          label.textContent = `ì¶”ê°€ ì§ˆë¬¸ ${index}:`;
        }
      });
      
      answerItems.forEach((item, index) => {
        const label = item.querySelector('label');
        if (index === 0) {
          label.textContent = 'ê¸°ë³¸ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µ:';
        } else {
          label.textContent = `ì¶”ê°€ ì§ˆë¬¸ ${index}ì— ëŒ€í•œ ë‹µ:`;
        }
      });
      
      // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸°ë„ ì—…ë°ì´íŠ¸
      updateQuestionPreviews();
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    window.addEventListener('load', function() {
      // ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì„¤ì •
      const today = new Date().toISOString().split('T')[0];
      const dateField = document.getElementById('date');
      if (!dateField.value) {
        dateField.value = today;
      }
      
      loadSavedData();
      
      // ëª¨ë“  ì…ë ¥ í•„ë“œì— ìë™ ì €ì¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document.addEventListener('input', autoSave);
      
      // ì§ˆë¬¸ ì…ë ¥ í•„ë“œì— ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document.querySelectorAll('#questionContent input').forEach(input => {
        input.addEventListener('input', updateQuestionPreviews);
      });
      
      // ì´ˆê¸° ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
      updateQuestionPreviews();
    });
  </script>
</body>
</html>